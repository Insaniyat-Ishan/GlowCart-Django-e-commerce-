{% extends "base.html" %}
{% load shop_extras %}
{% block title %}Your Account — GlowCart{% endblock %}
{% block content %}
<div class="container">
  <h1 class="h4 mb-3">Your Account</h1>
  <p class="text-muted mb-3">Logged in as <strong>{{ request.user.username }}</strong></p>

  {% if request.user.is_staff and store_metrics %}
  <div class="card p-3 mb-4">
    <div class="d-flex justify-content-between align-items-center">
      <h2 class="h6 mb-0">Store metrics (staff)</h2>
      <a class="btn btn-sm btn-outline-dark" href="/dashboard/metrics/">Full dashboard</a>
    </div>

    <div class="row text-center g-3 mt-2">
      <div class="col-6 col-md-3">
        <div class="border rounded-3 p-3">
          <div class="small text-muted">Total orders</div>
          <div class="h5 mb-0">{{ store_metrics.total_orders }}</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="border rounded-3 p-3">
          <div class="small text-muted">Total revenue</div>
          <div class="h5 mb-0">{{ store_metrics.total_revenue|money }}</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="border rounded-3 p-3">
          <div class="small text-muted">Last 7 days</div>
          <div class="h5 mb-0">{{ store_metrics.week_revenue|money }}</div>
        </div>
      </div>
      <div class="col-6 col-md-3">
        <div class="border rounded-3 p-3">
          <div class="small text-muted">Last 30 days</div>
          <div class="h5 mb-0">{{ store_metrics.month_revenue|money }}</div>
        </div>
      </div>
    </div>

    <h3 class="h6 mt-3">Top products</h3>
    <table class="table table-sm mb-0">
      <thead><tr><th>Product</th><th class="text-end">Qty</th><th class="text-end">Sales</th></tr></thead>
      <tbody>
        {% for r in store_metrics.top_products %}
          <tr>
            <td>{{ r.product__title }}</td>
            <td class="text-end">{{ r.qty }}</td>
            <td class="text-end">{{ r.sales|money }}</td>
          </tr>
        {% empty %}
          <tr><td colspan="3" class="text-muted">No data yet.</td></tr>
        {% endfor %}
      </tbody>
    </table>
  </div>
  {% endif %}

  <div class="d-flex justify-content-between align-items-center mb-2">
    <h2 class="h5 m-0">Addresses</h2>
    <a class="btn btn-sm btn-dark" href="/address/new/">Add Address</a>
  </div>

  <a class="btn btn-outline-dark btn-sm mb-3" href="/my-orders/">View Orders</a>

  {% if addresses %}
    <div class="row g-3">
      {% for a in addresses %}
      <div class="col-md-6">
        <div class="card p-3 h-100">
          <div class="d-flex justify-content-between">
            <strong>{{ a.full_name }}</strong>
            {% if a.is_default %}
              <span class="badge bg-dark">Default</span>
            {% else %}
              <a href="{% url 'address_make_default' a.id %}" class="btn btn-sm btn-outline-dark">Make default</a>
            {% endif %}
          </div>
          <div class="small text-muted">
            {{ a.line1 }}{% if a.line2 %}, {{ a.line2 }}{% endif %}, {{ a.city }}, {{ a.country }} {{ a.postcode }}
            {% if a.phone %}<br>☎ {{ a.phone }}{% endif %}
          </div>
        </div>
      </div>
      {% endfor %}
    </div>
  {% else %}
    <p class="text-muted">No addresses yet.</p>
  {% endif %}
</div>
{% endblock %}
