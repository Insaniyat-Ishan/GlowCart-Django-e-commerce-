{% extends "base.html" %}
{% load shop_extras %}
{% block title %}Your Cart — GlowCart{% endblock %}
{% block content %}
<div class="container">
  <h1 class="h4 mb-3">Your Cart</h1>

  {% if items %}
  <div class="row g-4">
    <!-- Items list -->
    <div class="col-lg-8">
      <div class="list-group">
        {% for it in items %}
          <div class="list-group-item">
            <div class="d-flex align-items-center">
              <!-- Thumbnail -->
              <a href="{{ it.product.get_absolute_url }}" class="me-3" style="width:96px; flex:0 0 96px;">
                {% if it.product.image %}
                  <img src="{{ it.product.image.url }}" alt="{{ it.product.title }}" style="width:96px;height:96px;object-fit:cover;border-radius:8px;border:1px solid #e9ecef;">
                {% elif it.product.image_url %}
                  <img src="{{ it.product.image_url }}" alt="{{ it.product.title }}" style="width:96px;height:96px;object-fit:cover;border-radius:8px;border:1px solid #e9ecef;">
                {% else %}
                  <img src="https://images.unsplash.com/photo-1611930022073-b7a4ba5fcccd?q=80&w=1200&auto=format&fit=crop" alt="{{ it.product.title }}" style="width:96px;height:96px;object-fit:cover;border-radius:8px;border:1px solid #e9ecef;">
                {% endif %}
              </a>

              <!-- Info -->
              <div class="flex-grow-1">
                <div class="d-flex justify-content-between">
                  <div>
                    <a class="text-dark text-decoration-none" href="{{ it.product.get_absolute_url }}">
                      <strong>{{ it.product.title }}</strong>
                    </a>
                    {% if it.variant %}
                      <div class="small text-muted">{{ it.variant.name }}</div>
                    {% endif %}
                    <div class="small text-muted">
                      {{ it.qty }} ×
                      {% if it.variant %}
                        {{ it.variant.display_price|money }}
                      {% else %}
                        {{ it.product.price|money }}
                      {% endif %}
                    </div>
                  </div>
                  <div class="text-end">
                    <div class="fw-semibold">{{ it.line_total|money }}</div>
                    <a class="btn btn-sm btn-outline-danger mt-2" href="{% url 'remove_from_cart' it.key %}">Remove</a>
                  </div>
                </div>
              </div>
            </div>
          </div>
        {% endfor %}
      </div>
    </div>

    <!-- Summary -->
    <div class="col-lg-4">
      <div class="card p-3" style="min-width: 320px;">
        <form class="input-group mb-2" method="post" action="{% url 'apply_coupon' %}">
          {% csrf_token %}
          <input name="code" class="form-control" placeholder="Coupon code" value="{{ coupon.code|default:'' }}">
          {% if coupon %}
            <a class="btn btn-outline-danger" href="{% url 'remove_coupon' %}">Remove</a>
          {% else %}
            <button class="btn btn-outline-dark" type="submit">Apply</button>
          {% endif %}
        </form>

        <div class="d-flex justify-content-between">
          <span>Subtotal</span><span>{{ subtotal|money }}</span>
        </div>
        {% if discount and discount > 0 %}
          <div class="d-flex justify-content-between text-success">
            <span>Discount ({{ coupon.code }})</span><span>-{{ discount|money }}</span>
          </div>
        {% endif %}
        <hr>
        <div class="d-flex justify-content-between">
          <span class="fw-semibold">Total</span><span class="fw-semibold">{{ total|money }}</span>
        </div>

        <div class="mt-3 d-grid gap-2">
          <a class="btn btn-dark" href="/checkout/">Proceed to Checkout</a>
          <a class="btn btn-outline-dark" href="/shop/">Continue Shopping</a>
        </div>
      </div>
    </div>
  </div>
  {% else %}
    <div class="text-center text-muted py-5">Your cart is empty.</div>
  {% endif %}
</div>
{% endblock %}
